<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>산책모집</title>
    <link rel="stylesheet" href="../css/detail.css">
    <link rel="stylesheet" href="../css/nav.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>
    <script src="../js/nav.js"></script>
    <script src="../js/detail.js"></script>
</head>
<body>
    <!-- nav 바 -->
    <div class="nav">
        <a class ="logo" href="./main.html">wɔːk meɪt</a>
        <div class="menu">
            <a class="menu_a" href="./create.html" href="#" onclick="checkLogin()">산책메이트 구하기</a>

            <a class="menu_a" href="./list.html">산책메이트 찾기</a>
        </div>
    </div>
    <!-- 파랑 in_nav 바 -->
    <div class="in_nav">

        <h2 id ="title">경상대학교에서 산책할 분 모집합니다~</h2>

    </div>
    <!-- contents -->
    <div class="container">
        <div class="container_item">
            <p>*지도에서 위치를 확인하세요!</p>
            <div id="staticMap" style="width:800px;height:400px;"></div>
            <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c6aa7b3f280d43b865071717aa200ff7&libraries=drawing"></script>
            <script>
                //페이지가 로드되면 함수를 실행
                var depLatitude, depLongitude;
                window.onload = function() {
                    loadDetail();
                }
                const sessionIsHost= (isHost)=>{
                    const account = isHost;
                    console.log(isHost);
                    if(isHost){
                    $('.container_item_in' ).append('<button onclick="deleteWalk()">삭제하기</button> ');}
                    else{
                        $('.container_item_in' ).append('<button onclick="applyWalk()">신청하기</button>');
                    }
                };
                const bodyChange = (data) => {
                    document.getElementById("title").innerText = data.body.title;
                    document.getElementById("depTime").innerText = data.body.depTime;
                    document.getElementById("maxMemberCount").innerText = data.body.maxMemberCount;
                    document.getElementById("description").innerText = data.body.description;
                    depLatitude = data.body.depLatitude;
                    depLongitude = data.body.depLongitude;

                    var markerPosition  = new kakao.maps.LatLng(depLatitude, depLongitude); 

                    // 이미지 지도에 표시할 마커입니다
                    // 이미지 지도에 표시할 마커는 Object 형태입니다
                    var marker = {
                        position: markerPosition
                    };

                    var staticMapContainer  = document.getElementById('staticMap'), // 이미지 지도를 표시할 div  
                        staticMapOption = { 
                            center: new kakao.maps.LatLng(depLatitude, depLongitude), // 이미지 지도의 중심좌표
                            level: 3, // 이미지 지도의 확대 레벨
                            marker: marker // 이미지 지도에 표시할 마커 
                        };    

                    // 이미지 지도를 생성합니다
                    var staticMap = new kakao.maps.StaticMap(staticMapContainer, staticMapOption);
                }
                function getWalkKey() {

                    var params = location.search.substr(location.search.indexOf("?") + 1);

                    var sval = "";
                    params = params.split("=");
                    console.log(params[1]);

                    return params[1];

                }
                const loadDetail = async () => {
                    const walkKey = getWalkKey();
                    if (walkKey) {
                        try {
                            const response = await axios.post("../php/walk/getWalkDetail.php", {
                                walkKey: walkKey,
                            });
                            if (response.data) {
                                console.log(response.data);
                                sessionIsHost(response.data.isHost);
                                bodyChange(response.data);
                            }

                        }
                        catch (error) {
                            console.log(error);
                        }
                    }
                }

            </script>
        </div>
        <div class="container_item">
            <div class="container_item_in">
                <div style="margin-bottom: 2rem;">
                    <p style="font-weight: 700; margin-right: 3rem; margin-bottom: 3rem;">날짜</p><p class="content" id="depTime"></p>
                </div>
                <div style="margin-bottom: 2rem;">
                    <p style="font-weight: 700; margin-right: 3rem; margin-bottom: 3rem;">모집인원</p><p class="content" id="maxMemberCount"></p>명
                </div>
                
                
                <p style="display: block;font-weight: 700;">한마디</p>
                <p class="content" id="description">"천천히 걸으면서 수다떠실 여자분들 구해요 ~"</p>
                
            </div>
        </div>
    </div>
    
</body>
</html>